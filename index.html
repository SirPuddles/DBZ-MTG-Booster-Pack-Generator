<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>DBZ MTG Pack Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{
    font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
    background:#0e0f13;
    color:#e9ecf1;
    margin:0;
    padding:24px;
  }
  h1{font-size:22px;margin:0 0 8px;}
  p{margin:0 0 16px;font-size:14px;color:#aab3c2;}
  .controls{display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap;}
  button{
    background:#4e7cff;
    border:none;
    border-radius:10px;
    color:#fff;
    padding:10px 16px;
    font-weight:600;
    cursor:pointer;
  }
  button:disabled{opacity:.5;cursor:not-allowed;}
  .pill{
    display:inline-block;
    padding:4px 10px;
    border-radius:999px;
    background:#181c27;
    color:#aab3c2;
    font-size:12px;
  }
  #status{font-size:13px;color:#93a0b5;}
  .pack{
    margin-top:16px;
    display:grid;
    grid-template-columns:repeat(5, minmax(0, 1fr));
    gap:10px;
  }
  .card{
    background:#111420;
    border-radius:12px;
    border:1px solid #2a2f3b;
    overflow:hidden;
    aspect-ratio:63/88;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
  }
  .card img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .card-label{
    position:absolute;
    left:4px;
    bottom:4px;
    font-size:10px;
    padding:2px 6px;
    border-radius:999px;
    background:rgba(0,0,0,0.7);
  }
</style>
</head>
<body>
<h1>DBZ Pack Generator</h1>
<p>Create a 15-card pack from your online card pool (10 commons, 3 uncommons, 1 rare/mythic, 1 token/land).</p>

<div class="controls">
  <button id="make" disabled>Make Pack</button>
  <span class="pill">Mythic odds: 1 in 8</span>
  <span id="status"></span>
</div>

<div id="pack" class="pack"></div>

<script>
const MYTHIC_ODDS = 8; // 1 in 8 packs gets a mythic instead of rare

let pool = {
  commons:   [],
  uncommons: [],
  rares:     [],
  mythics:   [],
  tokens:    []
};

function setStatus(msg){
  document.getElementById('status').textContent = msg;
}

function randomFrom(arr){
  if(!arr || arr.length === 0) return null;
  const idx = Math.floor(Math.random() * arr.length);
  return arr[idx]; // WITH replacement (we don't remove it)
}

function ensurePool(){
  if(pool.commons.length === 0)   throw new Error("No commons in manifest.");
  if(pool.uncommons.length === 0) throw new Error("No uncommons in manifest.");
  if(pool.rares.length === 0)     throw new Error("No rares in manifest.");
  if(pool.mythics.length === 0)   throw new Error("No mythics in manifest.");
  if(pool.tokens.length === 0)    throw new Error("No tokens/lands in manifest.");
}

function makePack(){
  try{
    ensurePool();
  }catch(e){
    alert(e.message);
    return;
  }

  const cards = [];

  // 10 commons
  for(let i=0;i<10;i++){
    cards.push({slot:"Common", card: randomFrom(pool.commons)});
  }
  // 3 uncommons
  for(let i=0;i<3;i++){
    cards.push({slot:"Uncommon", card: randomFrom(pool.uncommons)});
  }
  // 1 rare or mythic
  if(Math.floor(Math.random()*MYTHIC_ODDS) === 0){
    cards.push({slot:"Mythic", card: randomFrom(pool.mythics)});
  } else {
    cards.push({slot:"Rare", card: randomFrom(pool.rares)});
  }
  // 1 token / land
  cards.push({slot:"Token/Land", card: randomFrom(pool.tokens)});

  // Render
  const packDiv = document.getElementById('pack');
  packDiv.innerHTML = '';
  cards.forEach(entry=>{
    const div = document.createElement('div');
    div.className = 'card';
    const img = document.createElement('img');
    img.src = entry.card.image;
    img.alt = entry.card.name;
    img.title = entry.card.name + " â€” " + entry.slot;
    const label = document.createElement('div');
    label.className = 'card-label';
    label.textContent = entry.slot;
    div.appendChild(img);
    div.appendChild(label);
    packDiv.appendChild(div);
  });
}

async function loadManifest(){
  try{
    setStatus("Loading manifest.json...");
    const res = await fetch('manifest.json');
    if(!res.ok){
      throw new Error("HTTP " + res.status);
    }
    const data = await res.json();
    pool.commons   = data.commons   || [];
    pool.uncommons = data.uncommons || [];
    pool.rares     = data.rares     || [];
    pool.mythics   = data.mythics   || [];
    pool.tokens    = data.tokens    || [];
    ensurePool();
    setStatus("Loaded " +
      pool.commons.length   + " commons, " +
      pool.uncommons.length + " uncommons, " +
      pool.rares.length     + " rares, " +
      pool.mythics.length   + " mythics, " +
      pool.tokens.length    + " tokens/lands."
    );
    document.getElementById('make').disabled = false;
  }catch(e){
    console.error(e);
    setStatus("Error loading manifest.json: " + e.message);
  }
}

document.getElementById('make').addEventListener('click', makePack);
loadManifest();
</script>
</body>
</html>